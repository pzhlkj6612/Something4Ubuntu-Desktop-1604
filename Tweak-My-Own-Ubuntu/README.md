# Tweak My Own Ubuntu - 16.04 Only

![](./Beaver_Wallpaper_Grey_4096x2304.png?raw=true)

*I can eat glass, it does not hurt me.*

<br/>

## Whatever

### Things that we have to do first

```shell
sudo apt update && sudo apt upgrade -y
sudo reboot
sudo apt install -y vim
```

<br/>

### Get boot log

```shell
journalctl -b
```

```shell
dmesg
```

<br/>

Ref:

- [How to see log to find a boot problem - Ask Ubuntu](https://askubuntu.com/questions/91286/how-to-see-log-to-find-a-boot-problem)

Ref*:

- [How to get the boot logs for a 16.04 system that won&#39;t boot? - Ask Ubuntu](https://askubuntu.com/questions/872822/how-to-get-the-boot-logs-for-a-16-04-system-that-wont-boot)
- [linux - What is the difference between dmesg and journalctl - Unix &amp; Linux Stack Exchange](https://unix.stackexchange.com/questions/367146/what-is-the-difference-between-dmesg-and-journalctl)

<br/>

### "Could not get lock /var/lib/apt/lists/lock - open"

```
Reading package lists... Done
E: Could not get lock /var/lib/apt/lists/lock - open (11: Resource temporarily unavailable)
E: Unable to lock directory /var/lib/apt/lists/
```

...

<br/>

### Avoid hanging on "A start job is running for Raise network interfaces (Xmins Xs / Xmins Xs)" in booting

```
...
         Starting Wait until snapd is fully seeded...
[  OK  ] Started Wait until snapd is fully seeded.
[ ***  ] A start job is running for Raise network interfaces (2min 20s / 5min 1s)
```

After it,

```shell
systemd-analyze blame
```

```
     5min 2.242s networking.service
          3.436s apt-daily.service
           592ms dev-sda1.device
           442ms plymouth-quit-wait.service
           389ms libvirt-guests.service
             ... ...
```

```networking.service``` help us with configuring network such as DHCP, but it will failed when our LAN cable disconnected or wireless router cannot be access. *So, it tries again and again until finally some part of the OS gets the message.*

It's a lot of wasted time, isn't it?

#### You can fix your ip address instead of using DHCP

[Set a static IP and DNS servers](#set-a-static-ip-and-dns-servers).

<br/>

#### You can shorten the length of timeout

```networking.service``` is the name of the service which *raises or downs the network interfaces configured in ```/etc/network/interfaces```*. ```Raise network interfaces``` is the ```Description``` of it. Let's type a command to show the ```Unit File``` of the service.

```shell
sudo systemctl cat networking.service
```

```ini
# /lib/systemd/system/networking.service
[Unit]
Description=Raise network interfaces
...

[Service]
Type=oneshot
...
TimeoutStartSec=5min
...
```

```TimeoutStartSec``` is the key. Modifying the ```Unit File``` of system services directly is risky, so we need help from ```systemctl```.

```shell
sudo systemctl edit networking.service
```

```
------------------------------------------------------------------------------------------------------------
  GNU nano 2.5.3            File: /etc/systemd/system/networking.service.d/.#override.conf00000000FFFFFFFF
------------------------------------------------------------------------------------------------------------



|^G| Get Help     |^O| Write Out    |^W| Where is     |^K| Cut Text     |^J| Justify      |^C| Cur Pos      ...
|^X| Exit         |^R| Read File    |^\| Replace      |^U| Uncut Text   |^T| Tp Spell     |^_| Go To Line   ...
```

```/etc/systemd/system/networking.service.d/.#override.conf*``` is a new, empty file which generated by ```systemctl``` and stored in memory temporarily now. We can type some content into it.

```ini
[Service]
TimeoutStartSec=xxx
```

"xxx": *Takes a unit-less value in seconds, or a time span value such as "5min 20s".*

> When parsing, systemd will accept the same time span syntax. Separating spaces may be omitted. The following time units are understood:    
>     
> ·&nbsp;&nbsp;&nbsp;usec, us    
> ·&nbsp;&nbsp;&nbsp;msec, ms    
> ·&nbsp;&nbsp;&nbsp;seconds, second, sec, s    
> ·&nbsp;&nbsp;&nbsp;minutes, minute, min, m    
> ·&nbsp;&nbsp;&nbsp;hours, hour, hr, h    
> ·&nbsp;&nbsp;&nbsp;days, day, d    
> ·&nbsp;&nbsp;&nbsp;weeks, week, w    
> ·&nbsp;&nbsp;&nbsp;months, month, M (defined as 30.44 days)    
> ·&nbsp;&nbsp;&nbsp;years, year, y (define as 365.25 days)    
>     
> If no time unit is specified, generally seconds are assumed, but some exceptions exist and are marked as such. In a few cases "ns", "nsec" is accepted too, where the granularity of the time span allows for this.    
>     
> Examples for valid time span specifications:    
>     
> &nbsp;&nbsp;&nbsp;&nbsp;2 h    
> &nbsp;&nbsp;&nbsp;&nbsp;2hours    
> &nbsp;&nbsp;&nbsp;&nbsp;48hr    
> &nbsp;&nbsp;&nbsp;&nbsp;1y 12month    
> &nbsp;&nbsp;&nbsp;&nbsp;55s500ms    
> &nbsp;&nbsp;&nbsp;&nbsp;300ms20s 5day
>     
> *From: Ubuntu Manpage: systemd.time - Time and date specifications | 16.04*

Here are some examples,

```ini
[Service]
TimeoutStartSec=1001sec
```

```ini
[Service]
TimeoutStartSec=21min 57sec
```

```ini
[Service]
TimeoutStartSec=1year 2months 3weeks 4days 5hours 6minutes 7seconds 8msec 9usec
```

**DO NOT** set a value that is too large even though it will be ignored.

And, type ```Ctrl-X``` to exit, type ```y``` and ```Enter``` to save file. Then, reboot your system.

<br/>

#### (Dumb idea)You can let your network interface start as "hotplug" mode

```shell
sudo vi /etc/network/interfaces
```

```
# This file describes the network interfaces available in your system
# and how to activate then. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto enp2s0
iface enp2s0 inet dhcp
```

Now, ```enp2s0``` is using ```auto```, we should relpace it with ```allow-hotplug```,

```
# The primary network interface
allow-hotplug enp2s0
iface enp2s0 inet dhcp
```

At last, reboot your system.

<br/>

PS:

```allow-hotplug``` mode means:

- System only detect whether the interface is available at boot time
- After restart ```networking.service```, those "hotplug" interfaces will not be activated again and be assigned IP address automatically

So,

```shell
sudo ifup enp2s0
```

No information will be returned when everything goes correct. If DHCP has been set(e.g. ```iface enp2s0 inet dhcp```),

```
Internet Systems Consortium DHCP Client 4.3.3
Copyright 2004-2015 Internet Systems Consortium.
All rights reserved.
For info, please visit http://www.isc.org/software/dhcp/

Listening on LPF/enp2s0/FF:FF:FF:FF:FF:FF
Sending on   LPF/enp2s0/FF:FF:FF:FF:FF:FF
Sending on   Socket/fallback
DHCPDISCOVER on enp2s0 to 255.255.255.255 port 67 interval 3 (xid=0x12aae29)
DHCPDISCOVER on enp2s0 to 255.255.255.255 port 67 interval ...
DHCPREQUEST of 192.168.1.100 on enp2s0 to 255.255.255.255 port 67 (xid=0x29ae2a01)
DHCPOFFER of 192.168.1.100 from 192.168.1.1
DHCPACK of 192.168.1.100 from 192.168.1.1
bound to 192.168.1.100 -- renewal in 99887766554433221100 seconds.
```

<br/>

Ref:

- [\[ubuntu\] A start job is running for raise network interfaces (5 mins 1 sec) in ubuntu16.04](https://ubuntuforums.org/showthread.php?t=2323253)
- [networking - Very slow boot time ubuntu - A start job is running for Raise network interfaces - Ask Ubuntu](https://askubuntu.com/questions/841112/very-slow-boot-time-ubuntu-a-start-job-is-running-for-raise-network-interfaces)
- [systemd-analyze](https://www.freedesktop.org/software/systemd/man/systemd-analyze.html)
- [16.04 - What is the networking.service? - Ask Ubuntu](https://askubuntu.com/questions/850339/what-is-the-networking-service)

<br/>

- [configuration - How do I override or configure systemd services? - Ask Ubuntu](https://askubuntu.com/questions/659267/how-do-i-override-or-configure-systemd-services)
- [TimeoutStartSec= # systemd.service](https://www.freedesktop.org/software/systemd/man/systemd.service.html#TimeoutStartSec=)
- [Ubuntu Manpage: systemd.time - Time and date specifications | 16.04](http://manpages.ubuntu.com/manpages/xenial/man7/systemd.time.7.html)
- [Displaying a Unit File # How To Use Systemctl to Manage Systemd Services and Units | DigitalOcean](https://www.digitalocean.com/community/tutorials/how-to-use-systemctl-to-manage-systemd-services-and-units#displaying-a-unit-file)

<br/>

- [networking - Good detailed explanation of /etc/network/interfaces syntax? - Unix &amp; Linux Stack Exchange](https://unix.stackexchange.com/questions/128439/good-detailed-explanation-of-etc-network-interfaces-syntax/128662)
- [debian - What is a hotplug event from the interface? - Unix &amp; Linux Stack Exchange](https://unix.stackexchange.com/questions/192671/what-is-a-hotplug-event-from-the-interface)
- [Re: in /etc/network/interfaces:  &quot;auto&quot; vs &quot;allow-hotplug&quot;](https://lists.debian.org/debian-user/2017/09/msg00911.html)
- [dhclient(8) - Linux man page](https://linux.die.net/man/8/dhclient)
- [wireless - What&#39;s the difference between `ifconfig`, `interfaces`, `ifup` and `ifdown`? - Ask Ubuntu](https://askubuntu.com/questions/567683/whats-the-difference-between-ifconfig-interfaces-ifup-and-ifdown)
- [What is the difference between &#039;ifconfig up eth0&#039; and &#039;ifup eth0&#039;? - Red Hat Customer Portal](https://access.redhat.com/solutions/27166)
- [\[SOLVED\] Difference between ifconfig down and ifdown](https://www.linuxquestions.org/questions/linux-networking-3/difference-between-ifconfig-down-and-ifdown-4175440247/)
- [debian - Can&#39;t ifdown eth0 (main interface) - Unix &amp; Linux Stack Exchange](https://unix.stackexchange.com/questions/50602/cant-ifdown-eth0-main-interface)
- [\[server\] Cannot restart networking service](https://ubuntuforums.org/showthread.php?t=2218026)

Ref*:

- [networking - ifdown interface not configured (Debian 6) - Server Fault](https://serverfault.com/questions/549129/ifdown-interface-not-configured-debian-6)
- [\[SOLVED\] ifup and ifdown commands don't work.](https://www.linuxquestions.org/questions/linux-newbie-8/ifup-and-ifdown-commands-don%27t-work-915696/)

<br/>

### Set a static IP and DNS servers

*16.04 Only, IPv4 Only*

1. Which interface do I use for my static IP?

```shell
sudo ifconfig  -a
```

```
enp2s0    Link encap:Ethernet  HWaddr FF:FF:FF:FF:FF:FF
          inet addr:...
          ...

lo        Link encap:Local Loopback
          inet addr:127.0.0.1  Mask:255.0.0.0
          ...

...

```

```enp2s0``` is my choice.

2. Configure the network interface

```shell
sudo vi /etc/network/interfaces
```

```
# This file describes the network interfaces available in your system
# and how to activate then. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
auto enp2s0
iface enp2s0 inet dhcp
```

Now, ```enp2s0``` is using **D**ynamic **H**ost **C**onfiguration **P**rotocol, we should make some modifications and additions,

```
...
# The primary network interface
auto enp2s0
iface enp2s0 inet static
address xxx.xxx.xxx.xxx(your ip)
netmask xxx.xxx.xxx.xxx
gateway xxx.xxx.xxx.xxx(gateway ip, usually the address of the router)
```

If you want to set the addresses of DNS servers,

```
...
# The primary network interface
auto enp2s0
iface enp2s0 inet static
address xxx.xxx.xxx.xxx
netmask xxx.xxx.xxx.xxx
gateway xxx.xxx.xxx.xxx
dns-nameservers xxx.xxx.xxx.xxx(first DNS servers ip)
dns-nameservers xxx.xxx.xxx.xxx(second DNS servers ip)
```

Here is an example,

```
...
# The primary network interface
auto enp2s0
iface enp2s0 inet static
address 192.168.1.100
netmask 255.255.255.0
gateway 192.168.1.1
dns-nameservers 8.8.4.4
dns-nameservers 8.8.8.8
```

PS: **DO NOT** place multiple addresses on a single line, especially ```dns-nameservers```.

3. Put your settings into effect without reboot system

```shell
sudo ip address flush enp2s0 && sudo systemctl restart networking.service
```

Then, check IP,

```shell
sudo ifconfig  -a
```

```
enp2s0    Link encap:Ethernet  HWaddr FF:FF:FF:FF:FF:FF
          inet addr:192.168.1.100  Bcast:192.168.1.255  Mask:255.255.255.0
          ...

```

DNS,

```shell
cat /etc/resolv.conf
```

```
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 8.8.4.4
nameserver 8.8.8.8
```

<br/>

If something goes wrong, just reboot your system :(

<br/>

Ref:
- [Network configuration on Ubuntu 12.04 - 17.04 \(incl. Ubuntu 16.04 LTS\) # Linux Basics - Set a Static IP on Ubuntu](https://www.howtoforge.com/linux-basics-set-a-static-ip-on-ubuntu#ubuntu-incl-ubuntu-lts)
- [gather-info # How to set a static IP in Ubuntu - Ubuntu Network Configuration](http://www.sudo-juice.com/how-to-set-a-static-ip-in-ubuntu-network-confirguration/#gather-info)
- [networking - Network interface name changes after update to 15.10 - udev changes - Ask Ubuntu](https://askubuntu.com/questions/689070/network-interface-name-changes-after-update-to-15-10-udev-changes)
- [How to Restart Network in Ubuntu Server 16.04](http://www.configserverfirewall.com/ubuntu-linux/ubuntu-restart-network-interface/)
- [networking - Set static IP Ubuntu 16.04 - Ask Ubuntu](https://askubuntu.com/questions/766131/set-static-ip-ubuntu-16-04)
- [ip-addressing # Network Configuration](https://help.ubuntu.com/lts/serverguide/network-configuration.html#ip-addressing)
- [Command-line to list DNS servers used by my system - Ask Ubuntu](https://askubuntu.com/questions/152593/command-line-to-list-dns-servers-used-by-my-system)

Ref*:

- [Network Configuration](https://help.ubuntu.com/lts/serverguide/network-configuration.html)

<br/>

### Get wireless network

1. Install ```wpasupplicant``` and ```wireless-tools```

```shell
sudo apt install -y wpasupplicant wireless-tools
```

2. Find your netword device

```shell
sudo iwconfig
```

```
wlp3s0    IEEE 802.11bgn  ESSID:off/any
          Mode:Managed  Access Point: Not-Associated   Tx-Power=20 dBm
          Retry short limit:7   RTS thr=2347 B   Fragment thr:off
          Encryption key:off
          Power Management:on

enp2s0    no wireless extensions.

lo        no wireless extensions.

```

```wlp3s0``` is my wlan interface.

3. Bring the interface up

```shell
sudo ifup wlp3s0
```

4. Scan the world

```shell
sudo iwlist wlp3s0 scan | less
```

```
wlp3s0    Scan completed :
          Cell 01 - Address: FF:FF:FF:FF:FF:FF
                    Channel:1
                    Frequency:2.412 GHz (Channel 1)
                    Quality=70/70  Signal level=-8 dBm
                    Encryption key:on
                    ESSID:"NB"
                    Bit Rates:1 Mb/s; 2 Mb/s; 5.5 Mb/s; 11 Mb/s; 9 Mb/s
                              18 Mb/s; 36 Mb/s; 54 Mb/s
                    Bit Rates:6 Mb/s; 12 Mb/s; 24 Mb/s; 48 Mb/s
                    Mode:Master
                    ...
          Cell 02 - Address: ...
          ...

```

```NB``` is the SSID of my router.

...

<br/>

Ref:

- [Get wireless working under Ubuntu Server 16.04](https://ubuntuforums.org/showthread.php?t=2325768)
- [Linux WPA Supplicant \(IEEE 802.1X, WPA, WPA2, RSN, IEEE 802.11i\)](https://w1.fi/wpa_supplicant/)
- [SSID、BSSID、ESSID区别？ - 知乎](https://www.zhihu.com/question/24362037)

<br/>

### Automatic mount hard drives at boot time

#### Instruction

...

<br/>

#### Additional operations

Remember, It's **NECESSARY** to use the following command to validate your modified ```fstab```, unless you want to recover your system at next boot time.

```shell
sudo mount -a
```

No information will be returned when everything goes correct.

If ```<mount point>``` invalid,

```
mount: mount point /media/sdb1 does not exist
```

```<type>``` invalid,

```
mount: unknown filesystem type 'exr3'
```

```<file system>``` invalid,

```
mount: special device /dev/sdb1 does not exist
```

or,

```
mount: /home is not a block device
```

PS: ```<options>```, ```<dump>``` and ```<pass>``` will not be checked probably.

<br/>

#### Fix boot failure due to incorrect fstab

<br/>

Ref:

- [fedora - How do you validate fstab without rebooting? - Server Fault](https://serverfault.com/questions/174181/how-do-you-validate-fstab-without-rebooting)
- []()
- []()

Ref*:

- [Ubuntu: Mount The Drive From Command Line - nixCraft](https://www.cyberciti.biz/faq/mount-drive-from-command-line-ubuntu-linux/)
- [unity - How to automatically mount 2nd internal Hard Drive - Ask Ubuntu](https://askubuntu.com/questions/769974/how-to-automatically-mount-2nd-internal-hard-drive)
- [automount - How to make partitions mount at startup? - Ask Ubuntu](https://askubuntu.com/questions/164926/how-to-make-partitions-mount-at-startup)
- [A complete fstab guide - Linux Stall](http://www.linuxstall.com/fstab/)
- [Mount - Community Help Wiki](https://help.ubuntu.com/community/Mount)
- [Fstab - Community Help Wiki](https://help.ubuntu.com/community/Fstab)

<br/>

- [\[ubuntu\] fstab typo - recovery advice needed](https://ubuntuforums.org/showthread.php?t=1571596)
- [rhel - How to fix boot failure due to incorrect fstab? - Unix &amp; Linux Stack Exchange](https://unix.stackexchange.com/questions/44027/how-to-fix-boot-failure-due-to-incorrect-fstab)
- [How to Fix &quot;failed to mount /etc/fstab&quot; Error in Linux](https://www.tecmint.com/fix-failed-to-mount-etc-fstab-error-in-linux/)
- [Edit &quot;read-only&quot; /etc/fstab from &quot;System Recovery#&quot;  (without boot cd?)](https://www.linuxquestions.org/questions/linux-general-1/edit-read-only-etc-fstab-from-system-recovery-without-boot-cd-515239/)

<br/>

### Fix time differences between Ubuntu and Windows dual boot

<br/>

### Global Proxy

<br/>

### Change Linux console screen blanking behavior

```shell
setterm --blank 0
```

You can append it to your ```~/.bashrc```.

<br/>

**DO NOT** modify ```/etc/default/grub``` to reach it!

[My computer boots to a black screen, what options do I have to fix it? - Ask Ubuntu](https://askubuntu.com/questions/162075/my-computer-boots-to-a-black-screen-what-options-do-i-have-to-fix-it)

<br/>

Ref:

- [command line - How do I disable the blank console &quot;screensaver&quot; on Ubuntu Server? - Ask Ubuntu](https://askubuntu.com/questions/138918/how-do-i-disable-the-blank-console-screensaver-on-ubuntu-server)
- [Change Linux console screen blanking behavior - Super User](https://superuser.com/questions/152347/change-linux-console-screen-blanking-behavior/)

<br/>

- [basename(1) - Linux man page](https://linux.die.net/man/1/basename)

Ref*:

- [ubuntu - How do I permanently disable Linux&#39;s console screen saver, system-wide? - Server Fault](https://serverfault.com/questions/137728/how-do-i-permanently-disable-linuxs-console-screen-saver-system-wide)

<br/>

## Desktop Only

### Find wallpapers

```shell
ls -l /usr/share/backgrounds/
```

<br/>

Ref:

- [Where are the Unity desktop wallpapers located? - Ask Ubuntu](https://askubuntu.com/questions/272058/where-are-the-unity-desktop-wallpapers-located)
